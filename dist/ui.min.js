document.getElementById("asc-forms").addEventListener("submit",addASCFile),document.getElementById("scene-forms").addEventListener("submit",changeSceneFile),document.getElementById("camera-remote").addEventListener("submit",suppressDefault);const sin5=.0871557427,cos5=.996194698,remoteControls={state:"ROT",ROT:{down(){const e=state.scene.scene.camera.from,t=state.scene.scene.camera.to,[s,a,n]=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],c=[s,cos5*a-sin5*n,sin5*a+cos5*n];state.scene.scene.camera.from=[t[0]-c[0],t[1]-c[1],t[2]-c[2]]},up(){const e=state.scene.scene.camera.from,t=state.scene.scene.camera.to,[s,a,n]=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],c=[s,cos5*a+sin5*n,-sin5*a+cos5*n];state.scene.scene.camera.from=[t[0]-c[0],t[1]-c[1],t[2]-c[2]]},right(){const e=state.scene.scene.camera.from,t=state.scene.scene.camera.to,[s,a,n]=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],c=[cos5*s+sin5*n,a,-sin5*s+cos5*n];state.scene.scene.camera.from=[t[0]-c[0],t[1]-c[1],t[2]-c[2]]},left(){const e=state.scene.scene.camera.from,t=state.scene.scene.camera.to,[s,a,n]=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],c=[cos5*s-sin5*n,a,sin5*s+cos5*n];state.scene.scene.camera.from=[t[0]-c[0],t[1]-c[1],t[2]-c[2]]},in(){const e=state.scene.scene.camera.from,t=state.scene.scene.camera.to,[s,a,n]=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],c=[cos5*s-sin5*a,sin5*s+cos5*a,n];state.scene.scene.camera.from=[t[0]-c[0],t[1]-c[1],t[2]-c[2]]},out(){const e=state.scene.scene.camera.from,t=state.scene.scene.camera.to,[s,a,n]=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],c=[cos5*s+sin5*a,-sin5*s+cos5*a,n];state.scene.scene.camera.from=[t[0]-c[0],t[1]-c[1],t[2]-c[2]]}},TRN:{left(){state.scene.scene.camera.from[0]-=.1,state.scene.scene.camera.to[0]-=.1},right(){state.scene.scene.camera.from[0]+=.1,state.scene.scene.camera.to[0]+=.1},up(){state.scene.scene.camera.from[1]+=.1,state.scene.scene.camera.to[1]+=.1},down(){state.scene.scene.camera.from[1]-=.1,state.scene.scene.camera.to[1]-=.1},in(){state.scene.scene.camera.from[2]+=.1,state.scene.scene.camera.to[2]+=.1},out(){state.scene.scene.camera.from[2]-=.1,state.scene.scene.camera.to[2]-=.1}}};function addASCFile(e){e.preventDefault();const t=document.getElementById("asc-forms").elements,s=t.name.value,a=t.file;if(geometries.hasOwnProperty(s))alert("Do not copy names");else{const e=new FileReader;e.onload=(e=>{geometries[s]=processText(e.target.result)}),e.readAsText(a.files[0]);const t=document.getElementById("asc-files"),n=document.getElementById("file-template").cloneNode(!0);n.firstChild.innerText=s,n.lastChild.addEventListener("click",()=>{delete geometries[s]}),t.appendChild(n),n.style.display="block"}}function changeSceneFile(e){e.preventDefault();const t=document.getElementById("scene-forms").elements.file,s=new FileReader;s.onload=(e=>{state.scene=JSON.parse(e.target.result),console.log(state.scene),myredraw()}),s.readAsText(t.files[0])}function typeChange(){"cam-dir"==document.getElementById("camera-type").value?(document.getElementById("dir-f").hidden=!1,document.getElementById("place-f").hidden=!0):(document.getElementById("place-f").hidden=!1,document.getElementById("dir-f").hidden=!0)}function updateCamera(){const e=e=>Number(document.getElementById(e).value),t=(e,t)=>{e.forEach((e,s)=>document.getElementById(e).value=t[s])};let s,a;if("cam-dir"==document.getElementById("camera-type").value)console.log("dir+offset"),s=[e("nx0"),e("ny0"),e("nz0")],a=[e("rx"),e("ry"),e("rz")];else{let t=[e("off0"),e("off1"),e("off2")],n=[e("o0"),e("o1"),e("o2")];s=math.subtract(t,n),a=[e("off0"),e("off1"),e("off2")],console.log(s,a)}let n=math.divide(s,math.norm(s)),c=math.cross([0,1,0],n);c=math.divide(c,math.norm(c));let o=math.cross(n,c);o=math.divide(o,math.norm(o)),t(["ux","uy","uz"],c),t(["vx","vy","vz"],o),t(["nx","ny","nz"],n),camera=[c,o,n,a],camera_matrix=_camera_matrix(camera),raw_persp=["left","right","bottom","top","near","far"].map(e),myredraw()}function changeShader(e){switch(e.preventDefault(),document.getElementById("shader").elements.shader.value){case"phong":state.myshader=phongShader;break;case"goraud":state.myshader=goraudShader;break;default:state.myshader=defaultShader}myredraw()}function suppressDefault(e){e.preventDefault()}function switchRemoteMode(){const e=document.getElementById("camera-remote");remoteControls.state=e.elements.mode.value}function remote(e){remoteControls[remoteControls.state][e](),myredraw()}